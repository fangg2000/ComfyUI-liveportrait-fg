{
  "id": "401ec705-acdf-4aac-a84a-78759a9f0023",
  "revision": 0,
  "last_node_id": 24,
  "last_link_id": 29,
  "nodes": [
    {
      "id": 17,
      "type": "LiveportraitDriving",
      "pos": [
        998.8597412109375,
        98.55927276611328
      ],
      "size": [
        270,
        150
      ],
      "flags": {},
      "order": 6,
      "mode": 0,
      "inputs": [
        {
          "name": "driving",
          "type": "DRIVING",
          "link": 29
        },
        {
          "name": "image",
          "type": "IMAGE",
          "link": 17
        }
      ],
      "outputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "links": [
            22
          ]
        },
        {
          "name": "video_path",
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "Node name for S&R": "LiveportraitDriving"
      },
      "widgets_values": [
        "animal",
        2.2,
        0,
        -0.1
      ]
    },
    {
      "id": 21,
      "type": "VHS_VideoCombine",
      "pos": [
        1342.5726318359375,
        100.18793487548828
      ],
      "size": [
        378.4752197265625,
        706.4752197265625
      ],
      "flags": {},
      "order": 7,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 22
        },
        {
          "name": "audio",
          "shape": 7,
          "type": "AUDIO",
          "link": 23
        },
        {
          "name": "meta_batch",
          "shape": 7,
          "type": "VHS_BatchManager",
          "link": null
        },
        {
          "name": "vae",
          "shape": 7,
          "type": "VAE",
          "link": null
        },
        {
          "name": "frame_rate",
          "type": "FLOAT",
          "widget": {
            "name": "frame_rate"
          },
          "link": 25
        }
      ],
      "outputs": [
        {
          "name": "Filenames",
          "type": "VHS_FILENAMES",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-videohelpersuite",
        "ver": "3a96e87951f498ebcbb6d5bf685f6b0014c8f591",
        "Node name for S&R": "VHS_VideoCombine"
      },
      "widgets_values": {
        "frame_rate": 24,
        "loop_count": 0,
        "filename_prefix": "AnimateDiff",
        "format": "video/h264-mp4",
        "pix_fmt": "yuv420p",
        "crf": 19,
        "save_metadata": true,
        "trim_to_audio": false,
        "pingpong": false,
        "save_output": true,
        "videopreview": {
          "hidden": false,
          "paused": false,
          "params": {
            "filename": "AnimateDiff_00009-audio.mp4",
            "subfolder": "",
            "type": "output",
            "format": "video/h264-mp4",
            "frame_rate": 25,
            "workflow": "AnimateDiff_00009.png",
            "fullpath": "/home/fangg/other/tts/ComfyUI/output/AnimateDiff_00009-audio.mp4"
          }
        }
      }
    },
    {
      "id": 22,
      "type": "VHS_VideoInfo",
      "pos": [
        1007.3167724609375,
        425.6887512207031
      ],
      "size": [
        252.47132873535156,
        206
      ],
      "flags": {},
      "order": 5,
      "mode": 0,
      "inputs": [
        {
          "name": "video_info",
          "type": "VHS_VIDEOINFO",
          "link": 24
        }
      ],
      "outputs": [
        {
          "name": "source_fpsðŸŸ¨",
          "type": "FLOAT",
          "links": [
            25
          ]
        },
        {
          "name": "source_frame_countðŸŸ¨",
          "type": "INT",
          "links": null
        },
        {
          "name": "source_durationðŸŸ¨",
          "type": "FLOAT",
          "links": null
        },
        {
          "name": "source_widthðŸŸ¨",
          "type": "INT",
          "links": null
        },
        {
          "name": "source_heightðŸŸ¨",
          "type": "INT",
          "links": null
        },
        {
          "name": "loaded_fpsðŸŸ¦",
          "type": "FLOAT",
          "links": null
        },
        {
          "name": "loaded_frame_countðŸŸ¦",
          "type": "INT",
          "links": null
        },
        {
          "name": "loaded_durationðŸŸ¦",
          "type": "FLOAT",
          "links": null
        },
        {
          "name": "loaded_widthðŸŸ¦",
          "type": "INT",
          "links": null
        },
        {
          "name": "loaded_heightðŸŸ¦",
          "type": "INT",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfyui-videohelpersuite",
        "ver": "3a96e87951f498ebcbb6d5bf685f6b0014c8f591",
        "Node name for S&R": "VHS_VideoInfo"
      },
      "widgets_values": {}
    },
    {
      "id": 15,
      "type": "LiveportraitType",
      "pos": [
        51.84746170043945,
        501.0228271484375
      ],
      "size": [
        270,
        58
      ],
      "flags": {},
      "order": 0,
      "mode": 4,
      "inputs": [],
      "outputs": [
        {
          "name": "string",
          "type": "STRING",
          "links": null
        }
      ],
      "properties": {
        "Node name for S&R": "LiveportraitType"
      },
      "widgets_values": [
        "human"
      ]
    },
    {
      "id": 24,
      "type": "Note",
      "pos": [
        58.691349029541016,
        -250.75704956054688
      ],
      "size": [
        951.4298095703125,
        270.66473388671875
      ],
      "flags": {},
      "order": 1,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {},
      "widgets_values": [
        "ä»¥ä¸‹æ˜¯DeepSeekéœ€è¦æ‚¨ç‰¹åˆ«æ³¨æ„çš„å‚æ•°åŠå…¶ä½¿ç”¨å»ºè®®ï¼Œä»…ä¾›å‚è€ƒï¼š\n\n---\n\n### **1. ç²¾åº¦ä¸Žè®¾å¤‡ç›¸å…³å‚æ•° (Precision & Device)**\n- **`flag_use_half_precision`** (é»˜è®¤ `True`)  \n  - *English*: Use FP16 (half precision) for faster inference. **If you see black screens, set to `False` (FP32)** (GPU compatibility issue).  \n  - *ä¸­æ–‡*ï¼šå¯ç”¨FP16åŠç²¾åº¦åŠ é€ŸæŽ¨ç†ã€‚**å¦‚æžœå‡ºçŽ°é»‘å±ï¼Œè¯·è®¾ä¸º `False`**ï¼ˆåˆ‡æ¢ä¸ºFP32æ¨¡å¼ï¼Œå…¼å®¹æ€§æ›´å¥½ï¼‰ã€‚  \n\n- **`flag_force_cpu`** (é»˜è®¤ `False`)  \n  - *English*: Force CPU mode if GPU fails (slower but more stable).  \n  - *ä¸­æ–‡*ï¼šå¼ºåˆ¶ä½¿ç”¨CPUæ¨¡å¼ï¼ˆé€Ÿåº¦è¾ƒæ…¢ï¼Œä½†ç¨³å®šæ€§æ›´é«˜ï¼‰ã€‚  \n\n- **`device_id`** (é»˜è®¤ `0`)  \n  - *English*: Specify GPU ID (e.g., `0` for first GPU).  \n  - *ä¸­æ–‡*ï¼šæŒ‡å®šGPUç¼–å·ï¼ˆå¦‚ `0` è¡¨ç¤ºç¬¬ä¸€å—GPUï¼‰ã€‚  \n\n---\n\n### **2. åŠ¨ç”»æ•ˆæžœæŽ§åˆ¶ (Animation Control)**\n- **`driving_option`** (é»˜è®¤ `\"expression-friendly\"`)  \n  - *English*:  \n    - `\"expression-friendly\"`: Better for **human faces**, adapts driving motion naturally.  \n    - `\"pose-friendly\"`: Better for **extreme head poses** (e.g., animals).  \n  - *ä¸­æ–‡*ï¼š  \n    - `\"expression-friendly\"`ï¼šé€‚åˆ**äººè„¸**ï¼Œè¡¨æƒ…æ›´è‡ªç„¶ã€‚  \n    - `\"pose-friendly\"`ï¼šé€‚åˆ**å¤§å¹…å¤´éƒ¨è¿åŠ¨**ï¼ˆå¦‚åŠ¨ç‰©ï¼‰ã€‚  \n\n- **`driving_multiplier`** (é»˜è®¤ `1.0`)  \n  - *English*: Control motion intensity. `>1.0` = exaggerated, `<1.0` = subtle.  \n  - *ä¸­æ–‡*ï¼šæŽ§åˆ¶è¿åŠ¨å¹…åº¦ã€‚`>1.0` æ›´å¤¸å¼ ï¼Œ`<1.0` æ›´è½»å¾®ã€‚  \n\n- **`flag_stitching`** (é»˜è®¤ `True`)  \n  - *English*: Enable face stitching for **small head movements**. Disable (`False`) if source is an animal or large motion.  \n  - *ä¸­æ–‡*ï¼š**å°å¹…åº¦å¤´éƒ¨è¿åŠ¨**æ—¶å¯ç”¨ã€‚å¦‚æžœæ˜¯åŠ¨ç‰©æˆ–å¤§å¹…åº¦è¿åŠ¨ï¼Œå»ºè®®ç¦ç”¨ï¼ˆ`False`ï¼‰ã€‚  \n\n---\n\n### **3. å˜´éƒ¨ä¸Žçœ¼éƒ¨æŽ§åˆ¶ (Lip & Eye)**\n- **`flag_normalize_lip`** (é»˜è®¤ `False`)  \n  - *English*: Force lips to closed state before animation (if `flag_lip_retargeting=False`).  \n  - *ä¸­æ–‡*ï¼šåŠ¨ç”»å‰å¼ºåˆ¶é—­åˆå˜´å”‡ï¼ˆéœ€ `flag_lip_retargeting=False`ï¼‰ã€‚  \n\n- **`flag_eye_retargeting`** (é»˜è®¤ `False`)  \n  - *English*: **Not recommended!** May cause flickering (WIP feature).  \n  - *ä¸­æ–‡*ï¼š**ä¸å»ºè®®å¯ç”¨ï¼** å¯èƒ½å¯¼è‡´çœ¼éƒ¨é—ªçƒï¼ˆå®žéªŒæ€§åŠŸèƒ½ï¼‰ã€‚  \n\n---\n\n### **4. è§†é¢‘å¹³æ»‘åº¦ (Smoothing)**\n- **`driving_smooth_observation_variance`** (é»˜è®¤ `3e-7`)  \n  - *English*: Higher = smoother but less accurate motion. Adjust if video is jittery.  \n  - *ä¸­æ–‡*ï¼šå€¼è¶Šå¤§è¶Šå¹³æ»‘ï¼Œä½†ä¼šæŸå¤±ç»†èŠ‚ã€‚å¦‚æžœè§†é¢‘æŠ–åŠ¨å¯é€‚å½“å¢žåŠ ã€‚  \n\n---\n\n### **5. éŸ³é¢‘é€‰æ‹© (Audio)**\n- **`audio_priority`** (é»˜è®¤ `\"driving\"`)  \n  - *English*: Use audio from `\"driving\"` (é©±åŠ¨è§†é¢‘) or `\"source\"` (åŽŸå§‹è§†é¢‘).  \n  - *ä¸­æ–‡*ï¼šé€‰æ‹©ä½¿ç”¨`\"driving\"`ï¼ˆé©±åŠ¨è§†é¢‘ï¼‰æˆ–`\"source\"`ï¼ˆåŽŸå§‹è§†é¢‘ï¼‰çš„éŸ³é¢‘ã€‚  \n\n---\n\n### **6. äººè„¸è£å‰ª (Face Cropping)**\n- **`scale`** (é»˜è®¤ `2.3`)  \n  - *English*: Larger = smaller face area in crop. Adjust if face is cropped too tightly.  \n  - *ä¸­æ–‡*ï¼šå€¼è¶Šå¤§ï¼Œè£å‰ªåŒºåŸŸä¸­è„¸å æ¯”è¶Šå°ã€‚å¦‚æžœè„¸è¢«è£åˆ‡è¿‡å¤šå¯è°ƒå°ã€‚  \n\n- **`vy_ratio`** (é»˜è®¤ `-0.125`)  \n  - *English*: Vertical shift (`-` = up, `+` = down).  \n  - *ä¸­æ–‡*ï¼šåž‚ç›´åç§»ï¼ˆè´Ÿå€¼ä¸Šç§»ï¼Œæ­£å€¼ä¸‹ç§»ï¼‰ã€‚  \n\n---\n\n### **è°ƒè¯•æç¤º (Debug Tips)**  \n- **é»‘å±é—®é¢˜** â†’ è®¾ `flag_use_half_precision=False`ã€‚  \n- **æŠ–åŠ¨é—®é¢˜** â†’ å¢žåŠ  `driving_smooth_observation_variance` æˆ–æ£€æŸ¥ `flag_stitching`ã€‚  \n- **å˜´éƒ¨ä¸è‡ªç„¶** â†’ å°è¯• `flag_normalize_lip=True`ã€‚  \n\nå¦‚æžœéœ€è¦æ›´è¯¦ç»†çš„å‚æ•°ç»„åˆå»ºè®®ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„å…·ä½“åœºæ™¯ï¼ˆå¦‚â€œåŠ¨ç‰©è§†é¢‘â€æˆ–â€œå¤§å¹…å¤´éƒ¨è½¬åŠ¨â€ï¼‰ï¼ ðŸ› ï¸\n\n\n\n\nä¸‹é¢æ˜¯æœ¬æ’ä»¶å¼€å‘è€…è¦è¯´çš„â€¦â€¦å°±ä¸€ç‚¹ç‚¹ï¼š\n1ã€é€‰æ‹©drivingä¸‹æ‹‰èœå•çš„å€¼ï¼Œå°†ä½¿ç”¨ç¬¬2ç‚¹ä¿å­˜çš„è§†é¢‘æ¨¡æ¿ï¼›\n2ã€å¦‚æžœéœ€è¦ä¿å­˜æ¨¡æ¿ï¼Œåˆ™éœ€åœ¨save_driving_nameè¾“å…¥åç§°ã€‚\n"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 13,
      "type": "LoadImage",
      "pos": [
        49.57890701293945,
        101.07801055908203
      ],
      "size": [
        274.080078125,
        314.0000305175781
      ],
      "flags": {},
      "order": 2,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            17
          ]
        },
        {
          "name": "MASK",
          "type": "MASK",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.34",
        "Node name for S&R": "LoadImage"
      },
      "widgets_values": [
        "s23.jpg",
        "image"
      ]
    },
    {
      "id": 20,
      "type": "VHS_LoadVideo",
      "pos": [
        351.1588439941406,
        97.22653198242188
      ],
      "size": [
        251.52520751953125,
        555.5252075195312
      ],
      "flags": {},
      "order": 3,
      "mode": 0,
      "inputs": [
        {
          "name": "meta_batch",
          "shape": 7,
          "type": "VHS_BatchManager",
          "link": null
        },
        {
          "name": "vae",
          "shape": 7,
          "type": "VAE",
          "link": null
        }
      ],
      "outputs": [
        {
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            28
          ]
        },
        {
          "name": "frame_count",
          "type": "INT",
          "links": null
        },
        {
          "name": "audio",
          "type": "AUDIO",
          "links": [
            23
          ]
        },
        {
          "name": "video_info",
          "type": "VHS_VIDEOINFO",
          "links": [
            24
          ]
        }
      ],
      "properties": {
        "cnr_id": "comfyui-videohelpersuite",
        "ver": "3a96e87951f498ebcbb6d5bf685f6b0014c8f591",
        "Node name for S&R": "VHS_LoadVideo"
      },
      "widgets_values": {
        "video": "d11.mp4",
        "force_rate": 0,
        "custom_width": 0,
        "custom_height": 0,
        "frame_load_cap": 0,
        "skip_first_frames": 0,
        "select_every_nth": 1,
        "format": "AnimateDiff",
        "choose video to upload": "image",
        "videopreview": {
          "hidden": false,
          "paused": false,
          "params": {
            "filename": "d11.mp4",
            "type": "input",
            "format": "video/mp4",
            "force_rate": 0,
            "custom_width": 0,
            "custom_height": 0,
            "frame_load_cap": 0,
            "skip_first_frames": 0,
            "select_every_nth": 1
          }
        }
      }
    },
    {
      "id": 23,
      "type": "LiveportraitInit",
      "pos": [
        636.5819702148438,
        96.64010620117188
      ],
      "size": [
        306.119140625,
        658
      ],
      "flags": {},
      "order": 4,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "shape": 7,
          "type": "IMAGE",
          "link": 28
        }
      ],
      "outputs": [
        {
          "name": "driving",
          "type": "DRIVING",
          "links": [
            29
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "LiveportraitInit"
      },
      "widgets_values": [
        "",
        "",
        true,
        false,
        0,
        false,
        false,
        false,
        false,
        false,
        true,
        true,
        true,
        true,
        "expression-friendly",
        1,
        3e-7,
        "driving",
        "all",
        0.15,
        2.3,
        0,
        -0.125,
        true,
        1280,
        2
      ]
    }
  ],
  "links": [
    [
      17,
      13,
      0,
      17,
      1,
      "IMAGE"
    ],
    [
      22,
      17,
      0,
      21,
      0,
      "IMAGE"
    ],
    [
      23,
      20,
      2,
      21,
      1,
      "AUDIO"
    ],
    [
      24,
      20,
      3,
      22,
      0,
      "VHS_VIDEOINFO"
    ],
    [
      25,
      22,
      0,
      21,
      4,
      "FLOAT"
    ],
    [
      28,
      20,
      0,
      23,
      0,
      "IMAGE"
    ],
    [
      29,
      23,
      0,
      17,
      0,
      "DRIVING"
    ]
  ],
  "groups": [],
  "config": {},
  "extra": {
    "ds": {
      "scale": 1.1274924226921708,
      "offset": [
        110.67139926984898,
        60.4539801782286
      ]
    },
    "frontendVersion": "1.19.9",
    "VHS_latentpreview": false,
    "VHS_latentpreviewrate": 0,
    "VHS_MetadataImage": true,
    "VHS_KeepIntermediate": true
  },
  "version": 0.4
}